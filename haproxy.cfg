global
    log stdout format raw local0

defaults
    log     global
    mode    tcp
    option  tcplog
    timeout connect 50000ms
    timeout client  50000ms
    timeout server  50000ms

# Stats interface for monitoring
listen stats
    bind *:7000
    mode http
    stats enable
    stats uri /
    stats refresh 10s

# MariaDB balancing
frontend mariadb_frontend
    bind *:3307
    default_backend mariadb_backend

backend mariadb_backend
    balance leastconn
    # Check if node is ready to accept queries
    option tcp-check
    server node1 node1_tailscale_ip:3306 check
    server node2 node2_tailscale_ip:3306 check backup
    server node3 node3_tailscale_ip:3306 check backup
    
